schema: "io-iii-invariant-spec"
version: "v1.0"

id: "INV-001"
title: "Routing Table Integrity"
status: "active"
source_of_truth:
  - "./ADR/ADR-002-model-routing-and-fallback-policy.md"
  - "./IO-III/runtime/config/routing_table.yaml"

assertions:
  - name: "Routing selection is mode-driven"
    type: "yaml_equals"
    file: "./IO-III/runtime/config/routing_table.yaml"
    path: "rules.selection_method"
    expected: "mode"

  - name: "All modes defined"
    type: "yaml_has_keys"
    file: "./IO-III/runtime/config/routing_table.yaml"
    path: "modes"
    expected_keys:
      - "executor"
      - "explorer"
      - "challenger"
      - "synthesizer"
      - "visionary"

  - name: "Each mode has primary and secondary"
    type: "yaml_each_has_keys"
    file: "./IO-III/runtime/config/routing_table.yaml"
    path: "modes"
    each_item_required_keys:
      - "primary"
      - "secondary"

  - name: "Challenger is not user-facing"
    type: "yaml_equals"
    file: "./IO-III/runtime/config/routing_table.yaml"
    path: "rules.boundaries.challenger_user_facing"
    expected: false

  - name: "Single-voice guarantee is enabled"
    type: "yaml_equals"
    file: "./IO-III/runtime/config/routing_table.yaml"
    path: "rules.boundaries.single_voice_output"
    expected: true
